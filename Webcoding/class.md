# 网络编程串讲课核心内容总结
## 一、考试说明
### 1. 题型与分值
- 单选题：10题×2分=20分
- 多选题：5题×2分=10分
- 判断题：5题×2分=10分
- 简答题：4题（重点考察流程与原理）
- 综合应用题：设计类题目（如协议格式、程序流程）

### 2. 核心考察方向
- 基础概念（网络编程定义、协议特点、通信标识）
- 服务器选型与协议匹配
- 套接字编程流程与函数作用
- 数据传输边界处理与协议设计
- I/O模型（重点是Select模型）
- 高级编程基础（原始套接字、网卡编程）

## 二、网络编程基础
### 1. 核心定义
- 网络程序：分布式协同完成功能，核心是**网络通信**+**分布式部署**（客户端/服务器为典型部件）
- 通信标识：IP地址（主机标识）+端口号（应用程序标识），依赖DNS进行域名→IP转换
- 关键问题：拆分功能模块、标识通信实体、选择传输协议（TCP/UDP）、同步通信流程

### 2. 分层封装（TCP/IP模型）
| 层级       | 封装数据单元       |
|------------|--------------------|
| 数据链路层 | 帧（分段成帧）     |
| 网络层（IP）| IP数据报           |
| 传输层     | TCP报文段/UDP数据报 |
| 应用层     | 应用数据单元       |

## 三、通信模型
### 1. 核心模型对比
| 模型       | 特点                                  | 适用场景                  |
|------------|---------------------------------------|---------------------------|
| C/S（客户端-服务器） | 客户端主动请求，服务器被动响应（7×24运行） | 大部分网络应用（考试系统、文件传输） |
| B/S（浏览器-服务器） | 客户端为通用浏览器，功能集中在服务器端    | 网页应用（淘宝、成绩查询系统）        |
| P2P（对等网络）     | 节点兼具客户端+服务器功能，去中心化      | 文件下载、视频点播（抗摧毁性强）      |

### 2. 扩展优化
- 负载均衡：多服务器分流请求，避免单点过载
- 缓存机制：本地缓存热门数据（如地区新闻），提升响应速度
- 三级B/S结构：浏览器→Web服务器→数据库服务器（分离数据操作）

## 四、服务器选型
### 1. 按传输协议分类
| 类型         | 协议 | 特点                  | 适用场景                  |
|--------------|------|-----------------------|---------------------------|
| 面向连接服务器 | TCP  | 可靠传输、三次握手、流量控制 | 数据可靠性要求高（考试系统、文件传输） |
| 无连接服务器   | UDP  | 无连接、效率高、不可靠    | 实时性要求高（视频点播、DNS查询）    |

### 2. 按并发方式分类
| 类型       | 特点                                  | 适用场景                  |
|------------|---------------------------------------|---------------------------|
| 循环服务器   | 一次处理一个请求，编程简单、开销小      | 短期请求（时间服务器、ping）        |
| 并发服务器   | 每请求创建线程/进程，同时处理多请求    | 长期请求（视频点播、代理服务器）    |

### 3. 其他分类
- 瘦服务器/胖服务器：按服务端功能多少划分（瘦服务器→客户端功能多，反之亦然）

## 五、套接字编程核心
### 1. 套接字类型
| 类型         | 协议关联 | 核心特点                  | 函数流程                          |
|--------------|----------|---------------------------|-----------------------------------|
| 流式套接字（SOCK_STREAM） | TCP      | 可靠、有序、无边界        | 服务器：socket→bind→listen→accept→send/recv→closesocket<br>客户端：socket→connect→send/recv→closesocket |
| 数据报套接字（SOCK_DGRAM） | UDP      | 不可靠、有边界、支持广播/多播 | 服务器：socket→bind→recvfrom→sendto→closesocket<br>客户端：socket→sendto→recvfrom→closesocket |
| 原始套接字（SOCK_RAW）   | 无       | 操控IP/TCP首部，底层编程  | 适用于端口扫描、路径探测、自定义协议 |

### 2. 关键函数说明
- `socket()`：创建套接字（分配通信资源）
- `bind()`：绑定本地IP和端口号
- `listen()`：服务器进入监听状态（通知操作系统准备接收连接）
- `accept()`：从已完成连接队列取出连接，创建新套接字（三次握手由操作系统完成）
- `connect()`：客户端发起连接（填充远端IP/端口，触发三次握手）
- `send()`/`recv()`：流式套接字数据传输（仅拷贝数据到缓存，非实际发送/接收）
- `sendto()`/`recvfrom()`：数据报套接字传输（需指定目标地址，接收时获取源地址）

### 3. 关键注意事项
- 流式套接字无边界：需通过“关闭连接（返回0）”“长度前缀”“分隔符”标识数据结束
- 数据报套接字：接收缓存不足时数据会被截断，需约定报文最大长度
- 函数核心误区：`listen()`不执行三次握手，`send()`成功不代表数据到达对方

## 六、I/O模型
### 1. 核心问题
- 阻塞：函数等待资源就绪（如`recv`无数据时），浪费CPU资源
- 非阻塞：无资源时立即返回错误，需轮询查询，开销大

### 2. Select模型（重点考察）
- 核心功能：单线程监控多个套接字的读/写/异常事件
- 关键操作：`FD_ZERO()`（清空集合）、`FD_SET()`（添加套接字）、`FD_ISSET()`（判断就绪）、`FD_CLR()`（移除套接字）
- 注意事项：每次调用`select`前需备份集合（`select`会修改原集合），默认支持64个套接字

## 七、高级编程基础
### 1. 原始套接字
- 功能：可构造完整IP数据包（含首部），接收带IP首部的数据包
- 适用场景：端口扫描、路径探测、自定义协议开发
- 关键设置：`SIO_RCVALL`（接收所有报文）、网卡混杂模式（接收非本机目标报文）

### 2. 网卡编程（WinPcap）
- 核心流程：枚举网卡→选择网卡→打开网卡→设置过滤器→发送/接收数据包→关闭网卡
- 限制：无法直接实现防火墙（仅能捕获/分析流量，不能拦截）

## 八、重点提醒
1. 协议选择依据：可靠性要求（TCP）、实时性/效率要求（UDP）、数据量大小（大数据用TCP）
2. 常见错误：`listen()`执行三次握手（错误，由操作系统完成）、`send()`成功=数据到达（错误，仅拷贝到缓存）
3. 协议设计核心：解决数据边界问题（定长前缀、分隔符、关闭连接）
4. 考试重点：Select模型操作、套接字编程流程、服务器选型、TCP/UDP适用场景